<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>2021UnionCTF - WriteUp | ret2ver</title><meta name="author" content="Vergissmeinnicht"><meta name="copyright" content="Vergissmeinnicht"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="IntroductionThis is a small write up and recurrence for 2021UnionCTF. Cryptohuman_serverAnalysisThis is a Diffie-Hellman key exchange challenge: 1234567891011121314151617181920212223242526272829303132">
<meta property="og:type" content="article">
<meta property="og:title" content="2021UnionCTF - WriteUp">
<meta property="og:url" content="https://ret2ver.github.io/2021/02/23/2021UnionCTF-WriteUp/index.html">
<meta property="og:site_name" content="ret2ver">
<meta property="og:description" content="IntroductionThis is a small write up and recurrence for 2021UnionCTF. Cryptohuman_serverAnalysisThis is a Diffie-Hellman key exchange challenge: 1234567891011121314151617181920212223242526272829303132">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2021-02-23T10:53:01.000Z">
<meta property="article:modified_time" content="2022-05-04T12:52:56.963Z">
<meta property="article:author" content="Vergissmeinnicht">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ret2ver.github.io/2021/02/23/2021UnionCTF-WriteUp/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2021UnionCTF - WriteUp',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-04 20:52:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/04/29/RkrKDQiodbYj2eu.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">38</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">32</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ret2ver</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2021UnionCTF - WriteUp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-02-23T10:53:01.000Z" title="Created 2021-02-23 18:53:01">2021-02-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-05-04T12:52:56.963Z" title="Updated 2022-05-04 20:52:56">2022-05-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WriteUp/">WriteUp</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WriteUp/Crypto/">Crypto</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="2021UnionCTF - WriteUp"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This is a small write up and recurrence for 2021UnionCTF.</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="human-server"><a href="#human-server" class="headerlink" title="human_server"></a>human_server</h3><h4 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h4><p>This is a <code>Diffie-Hellman key exchange</code> challenge:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, random, hashlib, textwrap, json</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastecdsa.curve <span class="keyword">import</span> secp256k1</span><br><span class="line"><span class="keyword">from</span> fastecdsa.point <span class="keyword">import</span> Point</span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">b&#x27;union&#123;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">CURVE = secp256k1</span><br><span class="line">ORDER = CURVE.q</span><br><span class="line">G = CURVE.G</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EllipticCurveKeyExchange</span>():∏</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.private = random.randint(<span class="number">0</span>,ORDER)</span><br><span class="line">        self.public = self.get_public_key()</span><br><span class="line">        self.recieved = <span class="literal">None</span></span><br><span class="line">        self.nonce = <span class="literal">None</span></span><br><span class="line">        self.key = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_public_key</span>(<span class="params">self</span>):</span><br><span class="line">        A = G * self.private</span><br><span class="line">        <span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_public</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">print</span>(json.dumps(&#123;<span class="string">&quot;Px&quot;</span> : self.public.x, <span class="string">&quot;Py&quot;</span> : self.public.y&#125;))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">receive_public</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Remember to include the nonce for ultra-secure key exchange!</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        Px = <span class="built_in">int</span>(data[<span class="string">&quot;Px&quot;</span>])</span><br><span class="line">        Py = <span class="built_in">int</span>(data[<span class="string">&quot;Py&quot;</span>])</span><br><span class="line">        self.recieved = Point(Px, Py, curve=secp256k1)</span><br><span class="line">        self.nonce = <span class="built_in">int</span>(data[<span class="string">&#x27;nonce&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_shared_secret</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Generates the ultra secure secret with added nonce randomness</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">assert</span> self.nonce.bit_length() &gt; <span class="number">64</span></span><br><span class="line">        self.key = (self.recieved * self.private).x ^ self.nonce</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_fingerprint</span>(<span class="params">self, h2: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        If this is failing, remember that you must send the SAME</span></span><br><span class="line"><span class="string">        nonce to both Alice and Bob for the shared secret to match</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        h1 = hashlib.sha256(long_to_bytes(self.key)).hexdigest()</span><br><span class="line">        <span class="keyword">return</span> h1 == h2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_fingerprint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> hashlib.sha256(long_to_bytes(self.key)).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_header</span>(<span class="params">title: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n\n&#x27;</span>+<span class="string">&#x27;*&#x27;</span>*<span class="number">64</span>+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;*&#x27;</span>+title.center(<span class="number">62</span>)+<span class="string">&#x27;*\n&#x27;</span>+<span class="string">&#x27;*&#x27;</span>*<span class="number">64</span>+<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">input_json</span>(<span class="params">prompt: <span class="built_in">str</span></span>):</span><br><span class="line">    data = <span class="built_in">input</span>(prompt)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> json.loads(data)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Input must be sent as a JSON object&quot;</span>&#125;)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_flag</span>(<span class="params">shared_secret: <span class="built_in">int</span></span>):</span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    key = hashlib.sha1(long_to_bytes(shared_secret)).digest()[:<span class="number">16</span>]</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ciphertext = cipher.encrypt(pad(FLAG, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    data[<span class="string">&#x27;iv&#x27;</span>] = iv.<span class="built_in">hex</span>()</span><br><span class="line">    data[<span class="string">&#x27;encrypted_flag&#x27;</span>] = ciphertext.<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">print</span>(json.dumps(data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Alice = EllipticCurveKeyExchange()</span><br><span class="line">Bob = EllipticCurveKeyExchange()</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">&#x27;Welcome!&#x27;</span>) </span><br><span class="line">message = <span class="string">&quot;Hello! Thanks so much for jumping in to help. Ever since everyone left WhatsApp, we&#x27;ve had a hard time keeping up with communications. We&#x27;re hoping by outsourcing the message exchange to some CTF players we&#x27;ll keep the load down on our servers... All messages are end-to-end encrypted so there&#x27;s no privacy issues at all, we&#x27;ve even rolling out our new ultra-secure key exchange with enhanced randomness! Again, we really appreciate the help, feel free to add this experience to your CV!&quot;</span></span><br><span class="line">welcome = textwrap.fill(message, width=<span class="number">64</span>)          </span><br><span class="line"><span class="built_in">print</span>(welcome)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">&#x27;Alice sends public key&#x27;</span>)</span><br><span class="line">Alice.send_public()</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">&quot;Please forward Alice&#x27;s key to Bob&quot;</span>)</span><br><span class="line">alice_to_bob = input_json(<span class="string">&#x27;Send to Bob: &#x27;</span>)</span><br><span class="line">Bob.receive_public(alice_to_bob)</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">&#x27;Bob sends public key&#x27;</span>)</span><br><span class="line">Bob.send_public()</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">&quot;Please forward Bob&#x27;s key to Alice&quot;</span>)</span><br><span class="line">bob_to_alice = input_json(<span class="string">&#x27;Send to Alice: &#x27;</span>)</span><br><span class="line">Alice.receive_public(bob_to_alice)</span><br><span class="line">            </span><br><span class="line">Alice.get_shared_secret()</span><br><span class="line">Bob.get_shared_secret()</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">&#x27;Key verification in progress&#x27;</span>)</span><br><span class="line">alice_happy = Alice.check_fingerprint(Bob.send_fingerprint())</span><br><span class="line">bob_happy = Bob.check_fingerprint(Alice.send_fingerprint())</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> alice_happy <span class="keyword">or</span> <span class="keyword">not</span> bob_happy:</span><br><span class="line">    <span class="built_in">print</span>(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Alice and Bob panicked: Potential MITM attack in progress!!&quot;</span>&#125;)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">print_header(<span class="string">&#x27;Alice sends encrypted flag to Bob&#x27;</span>)</span><br><span class="line">encrypt_flag(Alice.key)</span><br></pre></td></tr></table></figure>

<p>We can use <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">Man-in-the-middle attack</a> to solve this challenge.</p>
<h4 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> json, hashlib</span><br><span class="line"><span class="keyword">from</span> fastecdsa.curve <span class="keyword">import</span> secp256k1</span><br><span class="line"><span class="keyword">from</span> fastecdsa.point <span class="keyword">import</span> Point</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">CURVE = secp256k1</span><br><span class="line">ORDER = CURVE.q</span><br><span class="line">G = CURVE.G</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;134.122.111.232&quot;</span>,<span class="number">54321</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&quot;&#123;\&quot;Px\&quot;: &quot;</span>)</span><br><span class="line">Px = <span class="built_in">int</span>(r.recvuntil(<span class="string">&quot;,&quot;</span>, drop = <span class="literal">True</span>))</span><br><span class="line">r.recvuntil(<span class="string">&quot;\&quot;Py\&quot;: &quot;</span>)</span><br><span class="line">Py = <span class="built_in">int</span>(r.recvuntil(<span class="string">&quot;&#125;&quot;</span>, drop = <span class="literal">True</span>))</span><br><span class="line">Pa = Point(Px, Py, curve = secp256k1)</span><br><span class="line">noncea = Pa.x</span><br><span class="line">P = json.dumps(&#123;<span class="string">&quot;Px&quot;</span> : G.x, <span class="string">&quot;Py&quot;</span> : G.y, <span class="string">&quot;nonce&quot;</span> : noncea&#125;)</span><br><span class="line">r.recvuntil(<span class="string">&quot;Send to Bob: &quot;</span>)</span><br><span class="line">r.sendline(P)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&quot;&#123;\&quot;Px\&quot;: &quot;</span>)</span><br><span class="line">Px = <span class="built_in">int</span>(r.recvuntil(<span class="string">&quot;,&quot;</span>, drop = <span class="literal">True</span>))</span><br><span class="line">r.recvuntil(<span class="string">&quot;\&quot;Py\&quot;: &quot;</span>)</span><br><span class="line">Py = <span class="built_in">int</span>(r.recvuntil(<span class="string">&quot;&#125;&quot;</span>, drop = <span class="literal">True</span>))</span><br><span class="line">Pb = Point(Px, Py, curve = secp256k1)</span><br><span class="line">nonceb = Pb.x</span><br><span class="line">P = json.dumps(&#123;<span class="string">&quot;Px&quot;</span> : G.x, <span class="string">&quot;Py&quot;</span> : G.y, <span class="string">&quot;nonce&quot;</span> : nonceb&#125;)</span><br><span class="line">r.recvuntil(<span class="string">&quot;Send to Alice: &quot;</span>)</span><br><span class="line">r.sendline(P)</span><br><span class="line"></span><br><span class="line">shared_secret = nonceb ^ noncea</span><br><span class="line">key = hashlib.sha1(long_to_bytes(shared_secret)).digest()[:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&quot;&#123;\&quot;iv\&quot;: \&quot;&quot;</span>)</span><br><span class="line">iv = <span class="built_in">bytes</span>.fromhex(r.recvuntil(<span class="string">&quot;\&quot;,&quot;</span>, drop = <span class="literal">True</span>).decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">r.recvuntil(<span class="string">&quot;\&quot;encrypted_flag\&quot;: \&quot;&quot;</span>)</span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(r.recvuntil(<span class="string">&quot;\&quot;&#125;&quot;</span>, drop = <span class="literal">True</span>).decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">r.close()</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">flag = cipher.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># union&#123;https://buttondown.email/cryptography-dispatches/archive/cryptography-dispatches-the-most-backdoor-looking/&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Mordell-primes"><a href="#Mordell-primes" class="headerlink" title="Mordell primes"></a>Mordell primes</h3><h4 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h4><p>This challenge use an <code>EllipticCurve</code> to generate primes and use RSA to encrypt the flag:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> k, FLAG</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> k &lt; <span class="number">2</span>^<span class="number">128</span></span><br><span class="line"><span class="keyword">assert</span> FLAG.startswith(<span class="string">b&#x27;union&#123;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">E = EllipticCurve(QQ,[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">78</span>,-<span class="number">16</span>])</span><br><span class="line">P = E(<span class="number">1</span>,<span class="number">8</span>)</span><br><span class="line">Q = k*P</span><br><span class="line">R = (k+<span class="number">1</span>)*P</span><br><span class="line"></span><br><span class="line">p = Q[<span class="number">0</span>].numerator()</span><br><span class="line">q = R[<span class="number">0</span>].numerator()</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> is_prime(p)</span><br><span class="line"><span class="keyword">assert</span> is_prime(q)</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">N = p*q</span><br><span class="line">m = bytes_to_long(FLAG)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;N = <span class="subst">&#123;N&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>If we traverse the value of k, we can find that the bit numbers of p and q are growing up. So we can use this way to find the right primes and decrypt the flag.</p>
<h4 id="Exp-1"><a href="#Exp-1" class="headerlink" title="Exp"></a>Exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">N = <span class="number">5766655232619116707100300967885753418146107012385091223647868658490220759057780928028480463319202968587922648810849492353260432268633862603886585796452077987022107158189728686203729104591090970460014498552122526631361162547166873599979607915485144034921458475288775124782641916030643521973787176170306963637370313115151225986951445919112900996709332382715307195702225692083801566649385695837056673372362114813257496330084467265988611009917735012603399494099393876040942830547181089862217042482330353171767145579181573964386356108368535032006591008562456350857902266767781457374500922664326761246791942069022937125224604306624131848290329098431374262949684569694816299414596732546870156381228669433939793464357484350276549975208686778594644420026103742256946843249910774816227113354923539933217563489950555104589202554713352263020111530716888917819520339737690357308261622980951534684991840202859984869712892892239141756252277430937886738881996771080147445410272938947061294178392301438819956947795539940433827913212756666332943009775475701914578705703916156436662432161</span></span><br><span class="line">c = <span class="number">5724500982804393999552325992634045287952804319750892943470915970483096772331551016916840383945269998524761532882411398692955440900351993530895920241101091918876067020996223165561345416503911263094097500885104850313790954974285883830265883951377056590933470243828132977718861754767642606894660459919704238136774273318467087409260763141245595380917501542229644505850343679013926414725687233193424516852921591707704514884213118566638296775961963799700542015369513133068927399421907223126861526282761409972982821215039263330243890963476417099153704260378890644297771730781222451447236238246395881031433918137098089530325766260576207689592620432966551477624532170121304029721231233790374192012764855164589022421648544518425385200094885713570919714631967210149469074074462611116405014013224660911261571843297746613484477218466538991573759885491965661063156805466483257274481271612649728798486179280969505996944359268315985465229137237546375405105660181489587704128670445623442389570543693177429900841406620324743316472579871371203563098020011949005568574852024281173097996529</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">30</span>):</span><br><span class="line">    E = EllipticCurve(QQ,[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">78</span>,-<span class="number">16</span>])</span><br><span class="line">    P = E(<span class="number">1</span>,<span class="number">8</span>)</span><br><span class="line">    Q = k*P</span><br><span class="line">    R = (k+<span class="number">1</span>)*P</span><br><span class="line">    p = Q[<span class="number">0</span>].numerator()</span><br><span class="line">    q = R[<span class="number">0</span>].numerator()</span><br><span class="line">    <span class="keyword">if</span> p * q == N:</span><br><span class="line">        phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">        d = inverse_mod(e,phi)</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,N)</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># union&#123;s34rch1ng_thr0ugh_r4tion4l_p01nts&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Cr0wn-St3rling"><a href="#Cr0wn-St3rling" class="headerlink" title="Cr0wn St3rling"></a>Cr0wn St3rling</h3><h4 id="Analysis-2"><a href="#Analysis-2" class="headerlink" title="Analysis"></a>Analysis</h4><p>This challenge is as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag, musical_key</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sieve_for_primes_to</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># Copyright Eratosthenes, 204 BC</span></span><br><span class="line">    size = n//<span class="number">2</span></span><br><span class="line">    sieve = [<span class="number">1</span>]*size</span><br><span class="line">    limit = <span class="built_in">int</span>(n**<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, limit):</span><br><span class="line">        <span class="keyword">if</span> sieve[i]:</span><br><span class="line">            val = <span class="number">2</span>*i+<span class="number">1</span></span><br><span class="line">            tmp = ((size-<span class="number">1</span>) - i)//val</span><br><span class="line">            sieve[i+val::val] = [<span class="number">0</span>]*tmp</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">2</span>] + [i*<span class="number">2</span>+<span class="number">1</span> <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(sieve) <span class="keyword">if</span> v <span class="keyword">and</span> i &gt; <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_quasi_prime</span>(<span class="params">n, primes</span>):</span><br><span class="line">    <span class="comment"># novel class of semi-prime numbers</span></span><br><span class="line">    <span class="comment"># https://arxiv.org/pdf/1903.08570.pdf</span></span><br><span class="line">    p2 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> p1 <span class="keyword">in</span> primes:</span><br><span class="line">        <span class="keyword">if</span> n % p1 == <span class="number">0</span>:</span><br><span class="line">            p2 = n//p1</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(p2) <span class="keyword">and</span> <span class="keyword">not</span> p1 <span class="keyword">in</span> [<span class="number">2</span>, <span class="number">3</span>] <span class="keyword">and</span> <span class="keyword">not</span> p2 <span class="keyword">in</span> [<span class="number">2</span>, <span class="number">3</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bbp_pi</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># Bailey-Borwein-Plouffe Formula</span></span><br><span class="line">    <span class="comment"># sounds almost as cool as Blum-Blum-Shub</span></span><br><span class="line">    <span class="comment"># nth hex digit of pi</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">j, n</span>):</span><br><span class="line">        s = <span class="number">0.0</span></span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> k &lt;= n:</span><br><span class="line">            r = <span class="number">8</span>*k+j</span><br><span class="line">            s = (s + <span class="built_in">pow</span>(<span class="number">16</span>, n-k, r) / r) % <span class="number">1.0</span></span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">        t = <span class="number">0.0</span></span><br><span class="line">        k = n + <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            newt = t + <span class="built_in">pow</span>(<span class="number">16</span>, n-k) / (<span class="number">8</span>*k+j)</span><br><span class="line">            <span class="keyword">if</span> t == newt:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                t = newt</span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> s + t</span><br><span class="line"></span><br><span class="line">    n -= <span class="number">1</span></span><br><span class="line">    x = (<span class="number">4</span>*S(<span class="number">1</span>, n) - <span class="number">2</span>*S(<span class="number">4</span>, n) - S(<span class="number">5</span>, n) - S(<span class="number">6</span>, n)) % <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;%02x&quot;</span> % <span class="built_in">int</span>(x * <span class="number">16</span>**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">digital_root</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># reveals Icositetragon modalities when applied to Fibonacci sequence</span></span><br><span class="line">    <span class="keyword">return</span> (n - <span class="number">1</span>) % <span class="number">9</span> + <span class="number">1</span> <span class="keyword">if</span> n <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fibonacci</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># Nature&#x27;s divine proportion gives high-speed oscillations of infinite</span></span><br><span class="line">    <span class="comment"># wave values of irrational numbers</span></span><br><span class="line">    <span class="keyword">assert</span>(n &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> n &lt; digital_root(<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_music</span>(<span class="params">music</span>):</span><br><span class="line">    <span class="comment"># Leverage music&#x27;s infinite variability</span></span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">all</span>(c <span class="keyword">in</span> <span class="string">&quot;ABCDEFG&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> music))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_number</span>(<span class="params">D</span>):</span><br><span class="line">    <span class="comment"># Checks if input symbolizes the digital root of oxygen</span></span><br><span class="line">    <span class="keyword">assert</span>(<span class="number">8</span>==D)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key</span>(<span class="params">motif</span>):</span><br><span class="line">    is_valid_music(motif)</span><br><span class="line">    is_valid_number(<span class="built_in">len</span>(motif))</span><br><span class="line">    <span class="comment"># transpose music onto transcendental frequencies</span></span><br><span class="line">    indexes = [(<span class="built_in">ord</span>(c)-<span class="number">0x40</span>)**i <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(motif)]</span><br><span class="line">    size = <span class="built_in">sum</span>(indexes)</span><br><span class="line">    <span class="keyword">assert</span>(size &lt; <span class="number">75000</span>) <span class="comment"># we will go larger when we have quantum</span></span><br><span class="line">    <span class="keyword">return</span> indexes, size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_q_grid</span>(<span class="params">size</span>):</span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size) <span class="keyword">if</span> is_quasi_prime(i, sieve_for_primes_to(math.floor(math.sqrt(size))+<span class="number">1</span>))]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Oscillating the key&quot;</span>)</span><br><span class="line">    key_indexes, size = get_key(musical_key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Generating quasi-prime grid&quot;</span>)</span><br><span class="line">    q_grid = get_q_grid(size)</span><br><span class="line">    <span class="comment"># print(f&quot;indexes: &#123;key_indexes&#125;  size: &#123;size&#125;  len(q_grid): &#123;len(q_grid)&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">for</span> i, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(flag):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] Entangling key and plaintext at position <span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">        index = key_indexes[i % <span class="built_in">len</span>(key_indexes)] * fibonacci(i)</span><br><span class="line">        q = q_grid[index % <span class="built_in">len</span>(q_grid)]</span><br><span class="line">        key_byte_hex = bbp_pi(q)</span><br><span class="line">        <span class="comment"># print(f&quot;index: &#123;index:10&#125;  fib: &#123;fibonacci(i):10&#125;  q-prime: &#123;q:10&#125;  keybyte: &#123;key_byte_hex:10&#125;&quot;)</span></span><br><span class="line">        out.append(<span class="built_in">ord</span>(p) ^ <span class="built_in">int</span>(key_byte_hex, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Encrypted: <span class="subst">&#123;<span class="built_in">bytes</span>(out).<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>We can know that the <code>musical_key</code> consists of these letters:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;ABCDEFG&quot;</span><br></pre></td></tr></table></figure>

<p>And its length is 8.</p>
<p>We know the flag head is <code>union&#123;</code>, so we can use this information to get the <code>2rd-6nd</code> letters of <code>musical_key</code>, and brute the remaining characters to get flag.</p>
<h4 id="Exp-2"><a href="#Exp-2" class="headerlink" title="Exp"></a>Exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">import</span> math, itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sieve_for_primes_to</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># Copyright Eratosthenes, 204 BC</span></span><br><span class="line">    size = n//<span class="number">2</span></span><br><span class="line">    sieve = [<span class="number">1</span>]*size</span><br><span class="line">    limit = <span class="built_in">int</span>(n**<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, limit):</span><br><span class="line">        <span class="keyword">if</span> sieve[i]:</span><br><span class="line">            val = <span class="number">2</span>*i+<span class="number">1</span></span><br><span class="line">            tmp = ((size-<span class="number">1</span>) - i)//val</span><br><span class="line">            sieve[i+val::val] = [<span class="number">0</span>]*tmp</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">2</span>] + [i*<span class="number">2</span>+<span class="number">1</span> <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(sieve) <span class="keyword">if</span> v <span class="keyword">and</span> i &gt; <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_quasi_prime</span>(<span class="params">n, primes</span>):</span><br><span class="line">    <span class="comment"># novel class of semi-prime numbers</span></span><br><span class="line">    <span class="comment"># https://arxiv.org/pdf/1903.08570.pdf</span></span><br><span class="line">    p2 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> p1 <span class="keyword">in</span> primes:</span><br><span class="line">        <span class="keyword">if</span> n % p1 == <span class="number">0</span>:</span><br><span class="line">            p2 = n//p1</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(p2) <span class="keyword">and</span> <span class="keyword">not</span> p1 <span class="keyword">in</span> [<span class="number">2</span>, <span class="number">3</span>] <span class="keyword">and</span> <span class="keyword">not</span> p2 <span class="keyword">in</span> [<span class="number">2</span>, <span class="number">3</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bbp_pi</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># Bailey-Borwein-Plouffe Formula</span></span><br><span class="line">    <span class="comment"># sounds almost as cool as Blum-Blum-Shub</span></span><br><span class="line">    <span class="comment"># nth hex digit of pi</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">j, n</span>):</span><br><span class="line">        s = <span class="number">0.0</span></span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> k &lt;= n:</span><br><span class="line">            r = <span class="number">8</span>*k+j</span><br><span class="line">            s = (s + <span class="built_in">pow</span>(<span class="number">16</span>, n-k, r) / r) % <span class="number">1.0</span></span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">        t = <span class="number">0.0</span></span><br><span class="line">        k = n + <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            newt = t + <span class="built_in">pow</span>(<span class="number">16</span>, n-k) / (<span class="number">8</span>*k+j)</span><br><span class="line">            <span class="keyword">if</span> t == newt:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                t = newt</span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> s + t</span><br><span class="line"></span><br><span class="line">    n -= <span class="number">1</span></span><br><span class="line">    x = (<span class="number">4</span>*S(<span class="number">1</span>, n) - <span class="number">2</span>*S(<span class="number">4</span>, n) - S(<span class="number">5</span>, n) - S(<span class="number">6</span>, n)) % <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;%02x&quot;</span> % <span class="built_in">int</span>(x * <span class="number">16</span>**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">digital_root</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># reveals Icositetragon modalities when applied to Fibonacci sequence</span></span><br><span class="line">    <span class="keyword">return</span> (n - <span class="number">1</span>) % <span class="number">9</span> + <span class="number">1</span> <span class="keyword">if</span> n <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fibonacci</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># Nature&#x27;s divine proportion gives high-speed oscillations of infinite</span></span><br><span class="line">    <span class="comment"># wave values of irrational numbers</span></span><br><span class="line">    <span class="keyword">assert</span>(n &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> n &lt; digital_root(<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_music</span>(<span class="params">music</span>):</span><br><span class="line">    <span class="comment"># Leverage music&#x27;s infinite variability</span></span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">all</span>(c <span class="keyword">in</span> <span class="string">&quot;ABCDEFG&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> music))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_number</span>(<span class="params">D</span>):</span><br><span class="line">    <span class="comment"># Checks if input symbolizes the digital root of oxygen</span></span><br><span class="line">    <span class="keyword">assert</span>(<span class="number">8</span>==D)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key</span>(<span class="params">motif</span>):</span><br><span class="line">    is_valid_music(motif)</span><br><span class="line">    is_valid_number(<span class="built_in">len</span>(motif))</span><br><span class="line">    <span class="comment"># transpose music onto transcendental frequencies</span></span><br><span class="line">    indexes = [(<span class="built_in">ord</span>(c)-<span class="number">0x40</span>)**i <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(motif)]</span><br><span class="line">    size = <span class="built_in">sum</span>(indexes)</span><br><span class="line">    <span class="keyword">assert</span>(size &lt; <span class="number">75000</span>) <span class="comment"># we will go larger when we have quantum</span></span><br><span class="line">    <span class="keyword">return</span> indexes, size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_q_grid</span>(<span class="params">size</span>):</span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size) <span class="keyword">if</span> is_quasi_prime(i, sieve_for_primes_to(math.floor(math.sqrt(size))+<span class="number">1</span>))]</span><br><span class="line"></span><br><span class="line">output = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;76f64667220717784affa07cf6b8be52c7d8348d778a41615efa9e53f2566b27fd96eb984c08&quot;</span>)</span><br><span class="line">known_flag = <span class="string">b&quot;union&#123;&quot;</span></span><br><span class="line">known_key_byte = [a ^ b <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(output,known_flag)]</span><br><span class="line"><span class="built_in">print</span>(known_key_byte)</span><br><span class="line"></span><br><span class="line">fibonacci_arr = [<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line">q_grid = get_q_grid(<span class="number">75000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="built_in">len</span>(output)):</span><br><span class="line">    fibonacci_arr.append(fibonacci_arr[i-<span class="number">1</span>] + fibonacci_arr[i-<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">musical_key = [<span class="string">&quot;*&quot;</span>] * <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(known_key_byte)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>):</span><br><span class="line">        index = (j ** i) * fibonacci_arr[i]</span><br><span class="line">        q = q_grid[index % <span class="built_in">len</span>(q_grid)]</span><br><span class="line">        key_byte_hex = bbp_pi(q)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(key_byte_hex,<span class="number">16</span>) == known_key_byte[i]:</span><br><span class="line">            musical_key[i] = <span class="built_in">chr</span>(<span class="number">0x40</span> + j)</span><br><span class="line"></span><br><span class="line">unkown_key_length = musical_key.count(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">dic = <span class="string">&quot;ABCDEFG&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.product(dic,repeat = unkown_key_length):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        brute_key = [i <span class="keyword">for</span> i <span class="keyword">in</span> musical_key]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(unkown_key_length):</span><br><span class="line">            idx = brute_key.index(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">            brute_key[idx] = i[j]</span><br><span class="line">        key_indexes, size = get_key(brute_key)</span><br><span class="line">        q_grid = get_q_grid(size)</span><br><span class="line">        flag = []</span><br><span class="line">        <span class="keyword">for</span> i, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(output):</span><br><span class="line">            index = key_indexes[i % <span class="built_in">len</span>(key_indexes)] * fibonacci_arr[i]</span><br><span class="line">            q = q_grid[index % <span class="built_in">len</span>(q_grid)]</span><br><span class="line">            key_byte_hex = bbp_pi(q)</span><br><span class="line">            flag.append(p ^ <span class="built_in">int</span>(key_byte_hex, <span class="number">16</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># union&#123;b45ed_oN_iRR3fut4bL3_m4th3m4G1c&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Neo-Classical-Key-Exchange"><a href="#Neo-Classical-Key-Exchange" class="headerlink" title="Neo-Classical Key Exchange"></a>Neo-Classical Key Exchange</h3><p>This writeup is referenced from <a target="_blank" rel="noopener" href="https://rkm0959.tistory.com/206">rkm0959</a></p>
<h4 id="Analysis-3"><a href="#Analysis-3" class="headerlink" title="Analysis"></a>Analysis</h4><p>This is a <code>Diffie-Hellman key exchange</code> challenge with matrices over Fp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">b&quot;union&#123;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_valid</span>(<span class="params">l</span>):</span><br><span class="line">    x = l // <span class="number">2</span></span><br><span class="line">    checked = <span class="built_in">set</span>([x])</span><br><span class="line">    <span class="keyword">while</span> x * x != l:</span><br><span class="line">        x = (x + (l // x)) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> checked: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        checked.add(x)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_iter</span>(<span class="params">n</span>):</span><br><span class="line">    x = n</span><br><span class="line">    y = (x + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x = y</span><br><span class="line">        y = (x + n // x) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_mul</span>(<span class="params">l1,l2,p</span>):</span><br><span class="line">    X, Y = <span class="built_in">len</span>(l1), <span class="built_in">len</span>(l2)</span><br><span class="line">    Z = list_iter(X)</span><br><span class="line">    <span class="keyword">assert</span> X == Y</span><br><span class="line">    <span class="keyword">assert</span> list_valid(X)</span><br><span class="line">    l3 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Z):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(Z):</span><br><span class="line">            prod_list = [x*y <span class="keyword">for</span> x,y <span class="keyword">in</span> <span class="built_in">zip</span>(l1[Z*i:Z*(i+<span class="number">1</span>)], l2[j::Z])]</span><br><span class="line">            sum_list = <span class="built_in">sum</span>(prod_list) % p</span><br><span class="line">            l3.append(sum_list)</span><br><span class="line">    <span class="keyword">return</span> l3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_exp</span>(<span class="params">l0, e, p</span>):</span><br><span class="line">    exp = <span class="built_in">bin</span>(e)[<span class="number">3</span>::]</span><br><span class="line">    l = l0</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> exp:</span><br><span class="line">        l = list_mul(l,l,p)</span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            l = list_mul(l,l0,p)</span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_public_key</span>(<span class="params">G,p</span>):</span><br><span class="line">    k = randint(<span class="number">2</span>,p-<span class="number">1</span>)</span><br><span class="line">    B = list_exp(G,k,p)</span><br><span class="line">    <span class="keyword">return</span> B,k</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_shared_secret</span>(<span class="params">M,k,p</span>):</span><br><span class="line">    S = list_exp(M,k,p)</span><br><span class="line">    <span class="keyword">return</span> S[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_flag</span>(<span class="params">shared_secret: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="comment"># Derive AES key from shared secret</span></span><br><span class="line">    key = sha1(<span class="built_in">str</span>(shared_secret).encode(<span class="string">&#x27;ascii&#x27;</span>)).digest()[:<span class="number">16</span>]</span><br><span class="line">    <span class="comment"># Encrypt flag</span></span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ciphertext = cipher.encrypt(pad(FLAG, <span class="number">16</span>))</span><br><span class="line">    <span class="comment"># Prepare data to send</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    data[<span class="string">&#x27;iv&#x27;</span>] = iv.<span class="built_in">hex</span>()</span><br><span class="line">    data[<span class="string">&#x27;encrypted_flag&#x27;</span>] = ciphertext.<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">p = <span class="number">64050696188665199345192377656931194086566536936726816377438460361325379667067</span></span><br><span class="line">G = [<span class="number">37474442957545178764106324981526765864975539603703225974060597893616967420393</span>,<span class="number">59548952493843765553320545295586414418025029050337357927081996502641013504519</span>, <span class="number">31100206652551216470993800087401304955064478829626836705672452903908942403749</span>, <span class="number">13860314824542875724070123811379531915581644656235299920466618156218632047734</span>, <span class="number">20708638990322428536520731257757756431087939910637434308755686013682215836263</span>, <span class="number">24952549146521449536973107355293130621158296115716203042289903292398131137622</span>, <span class="number">10218366819256412940642638446599581386178890340698004603581416301746386415327</span>, <span class="number">2703573504536926632262901165642757957865606616503182053867895322013282739647</span>, <span class="number">15879294441389987904495146729489455626323759671332021432053969162532650514737</span>, <span class="number">30587605323370564700860148975988622662724284710157566957213620913591119857266</span>, <span class="number">36611042243620159284891739300872570923754844379301712429812256285632664939438</span>, <span class="number">58718914241625123259194313738101735115927103160409788235233580788592491022607</span>, <span class="number">18794394402264910240234942692440221176187631522440611503354694959423849000390</span>, <span class="number">37895552711677819212080891019935360298287165077162751096430149138287175198792</span>, <span class="number">42606523043195439411148917099933299291240308126833074779715029926129592539269</span>, <span class="number">58823705349101783144068766123926443603026261539055007453105405205925131925190</span>, <span class="number">5161282521824450434107880210047438744043346780853067016037814677431009278694</span>, <span class="number">3196376473514329905892186470188661558538142801087733055324234265182313048345</span>, <span class="number">37727162280974181457962922331112777744780166735208107725039910555667476286294</span>, <span class="number">43375207256050745127045919163601367018956550763591458462169205918826786898398</span>, <span class="number">21316240287865348172884609677159994196623096993962103476517743037154705924312</span>, <span class="number">7032356850437797415676110660436413346535063433156355547532408592015995190002</span>, <span class="number">3916163687745653495848908537554668396996224820204992858702838114767399600995</span>, <span class="number">13665661150287720594400034444826365313288645670526357669076978338398633256587</span>,<span class="number">23887025917289715287437926862183042001010845671403682948840305587666551788353</span>]</span><br><span class="line">A,a = gen_public_key(G,p)</span><br><span class="line">B,b = gen_public_key(G,p)</span><br><span class="line"><span class="keyword">assert</span> gen_shared_secret(A,b,p) == gen_shared_secret(B,a,p)</span><br><span class="line"></span><br><span class="line">shared_secret = gen_shared_secret(B,a,p)</span><br><span class="line">encrypted_flag = encrypt_flag(shared_secret)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Alice&#x27;s public key: <span class="subst">&#123;A&#125;</span>&quot;</span>) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Bob&#x27;s public key: <span class="subst">&#123;B&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encrypted flag: <span class="subst">&#123;encrypted_flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>This is a <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Discrete_logarithm">Discrete Logarithm Problem</a> with matrices.</p>
<p>Consider following things:</p>
<p>The <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Jordan_normal_form">Jordan Canonical Form</a> of <code>G</code> is as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ 935653797092383|               0|               0|               0                0]</span><br><span class="line">[----------------+----------------+----------------+---------------------------------]</span><br><span class="line">[               0| 895583106357469|               0|               0                0]</span><br><span class="line">[----------------+----------------+----------------+---------------------------------]</span><br><span class="line">[               0|               0| 741118640597053|               0                0]</span><br><span class="line">[----------------+----------------+----------------+---------------------------------]</span><br><span class="line">[               0|               0|               0|1001557463764859                1]</span><br><span class="line">[               0|               0|               0|               0 1001557463764859]</span><br></pre></td></tr></table></figure>

<p>And we can find that:</p>
<p>$$<br>G^a &#x3D; A \\<br>G &#x3D; PJP^{-1} \\<br>J^a &#x3D; P^{-1}AP<br>$$</p>
<p>We focus on the sub-matrix in the lower right corner of $G$(assume as $S$), its form is as follows:<br>$$<br>S &#x3D;<br> \left[<br> \begin{matrix}<br>   \lambda &amp; 1  \\<br>   0 &amp; \lambda  \\<br>  \end{matrix}<br>  \right]<br>$$</p>
<p>Then:<br>$$<br>S^a &#x3D;<br> \left[<br> \begin{matrix}<br>   \lambda^a &amp; a\lambda^{a-1}  \\<br>   0 &amp; \lambda^a  \\<br>  \end{matrix}<br>  \right]<br>$$</p>
<p>And we can get <code>a</code> as:</p>
<p>$$<br>a &#x3D; (a\lambda^{a-1} \times \lambda) &#x2F; \lambda^a<br>$$<br>Finally we can solve this <code>dlp</code> problem.</p>
<h4 id="Exp-3"><a href="#Exp-3" class="headerlink" title="Exp"></a>Exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_valid</span>(<span class="params">l</span>):</span><br><span class="line">    x = l // <span class="number">2</span></span><br><span class="line">    checked = <span class="built_in">set</span>([x])</span><br><span class="line">    <span class="keyword">while</span> x * x != l:</span><br><span class="line">        x = (x + (l // x)) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> checked: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        checked.add(x)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_iter</span>(<span class="params">n</span>):</span><br><span class="line">    x = n</span><br><span class="line">    y = (x + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x = y</span><br><span class="line">        y = (x + n // x) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_mul</span>(<span class="params">l1,l2,p</span>):</span><br><span class="line">    X, Y = <span class="built_in">len</span>(l1), <span class="built_in">len</span>(l2)</span><br><span class="line">    Z = list_iter(X)</span><br><span class="line">    <span class="keyword">assert</span> X == Y</span><br><span class="line">    <span class="keyword">assert</span> list_valid(X)</span><br><span class="line">    l3 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Z):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(Z):</span><br><span class="line">            prod_list = [x*y <span class="keyword">for</span> x,y <span class="keyword">in</span> <span class="built_in">zip</span>(l1[Z*i:Z*(i+<span class="number">1</span>)], l2[j::Z])]</span><br><span class="line">            sum_list = <span class="built_in">sum</span>(prod_list) % p</span><br><span class="line">            l3.append(sum_list)</span><br><span class="line">    <span class="keyword">return</span> l3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_exp</span>(<span class="params">l0, e, p</span>):</span><br><span class="line">    exp = <span class="built_in">bin</span>(e)[<span class="number">3</span>::]</span><br><span class="line">    l = l0</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> exp:</span><br><span class="line">        l = list_mul(l,l,p)</span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            l = list_mul(l,l0,p)</span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line"></span><br><span class="line">p = <span class="number">64050696188665199345192377656931194086566536936726816377438460361325379667067</span></span><br><span class="line">G = [<span class="number">37474442957545178764106324981526765864975539603703225974060597893616967420393</span>,<span class="number">59548952493843765553320545295586414418025029050337357927081996502641013504519</span>, <span class="number">31100206652551216470993800087401304955064478829626836705672452903908942403749</span>, <span class="number">13860314824542875724070123811379531915581644656235299920466618156218632047734</span>, <span class="number">20708638990322428536520731257757756431087939910637434308755686013682215836263</span>, <span class="number">24952549146521449536973107355293130621158296115716203042289903292398131137622</span>, <span class="number">10218366819256412940642638446599581386178890340698004603581416301746386415327</span>, <span class="number">2703573504536926632262901165642757957865606616503182053867895322013282739647</span>, <span class="number">15879294441389987904495146729489455626323759671332021432053969162532650514737</span>, <span class="number">30587605323370564700860148975988622662724284710157566957213620913591119857266</span>, <span class="number">36611042243620159284891739300872570923754844379301712429812256285632664939438</span>, <span class="number">58718914241625123259194313738101735115927103160409788235233580788592491022607</span>, <span class="number">18794394402264910240234942692440221176187631522440611503354694959423849000390</span>, <span class="number">37895552711677819212080891019935360298287165077162751096430149138287175198792</span>, <span class="number">42606523043195439411148917099933299291240308126833074779715029926129592539269</span>, <span class="number">58823705349101783144068766123926443603026261539055007453105405205925131925190</span>, <span class="number">5161282521824450434107880210047438744043346780853067016037814677431009278694</span>, <span class="number">3196376473514329905892186470188661558538142801087733055324234265182313048345</span>, <span class="number">37727162280974181457962922331112777744780166735208107725039910555667476286294</span>, <span class="number">43375207256050745127045919163601367018956550763591458462169205918826786898398</span>, <span class="number">21316240287865348172884609677159994196623096993962103476517743037154705924312</span>, <span class="number">7032356850437797415676110660436413346535063433156355547532408592015995190002</span>, <span class="number">3916163687745653495848908537554668396996224820204992858702838114767399600995</span>, <span class="number">13665661150287720594400034444826365313288645670526357669076978338398633256587</span>,<span class="number">23887025917289715287437926862183042001010845671403682948840305587666551788353</span>]</span><br><span class="line">A = [<span class="number">28233100393684529817120826374704703970604351085347992179309675559635346595380</span>, <span class="number">29046194176577252146425228713999025714624645466020308483596362772799464421565</span>, <span class="number">51414757515365785106884177690982449232859118016584164030996802978303073832864</span>, <span class="number">32267784952174932165833922809968200325881642530032757218932833269493776228149</span>, <span class="number">13973793666546842231063337975335309683360495651176415377710477331321414420456</span>, <span class="number">5286615045753246138573595226543740641269173696296954823357812924414572937107</span>, <span class="number">43466342875687159863281474559075034075049932698505922755874901032656831073450</span>, <span class="number">47661605030033906449833071780503259530559725918766113764853049109959949029047</span>, <span class="number">29762627612115411002000295970517549686591898340299041949451816959553956035443</span>, <span class="number">49286580271478233284518064235175477517034865850564346192909446300261247213283</span>, <span class="number">7188366615080791208945602088806130718221011202809096314763875728464565550249</span>, <span class="number">32182006086354456048519258721570301235369694461013162635052191913678704872393</span>, <span class="number">21483240138613555020973495536958806124512132313438467660300656866733958284555</span>, <span class="number">32536424410469390868658830924897162415670475154843962198873348894987606529091</span>, <span class="number">45625096994113674714302106480828933542072238055815294252728640125290264970846</span>, <span class="number">24213002979296722993383462232491867853999792671040421022480792914763688570011</span>, <span class="number">20226375341521636699395168981434607973732973904867124197482261876438894251202</span>, <span class="number">35665173793762989154951727010732056807487002272231939587142706779138064036737</span>, <span class="number">44918569326474189030005211458487723881627056771470698141626869348302159144544</span>, <span class="number">55135331348727541614492445208303357763346452332141430109351274117544563056325</span>, <span class="number">3933992047445840422521143559241271788171754114229341734112783430664672779696</span>, <span class="number">21801264227118954504981594527645803342623213184399008070689042493499060756930</span>, <span class="number">36511317987578612540784999849026900531836613400317039182698008103871338654381</span>, <span class="number">26496131888936628842836360667203182676230332105839869360126226904814961091203</span>, <span class="number">30731439605443071877356819320867001660509853590875860716545460172180769908374</span>]</span><br><span class="line">B = [<span class="number">44377211427173233116979050195003801151862259928694524276865425496276215498972</span>, <span class="number">49241196843948436830587713696810940169354056619506533754073633670263404255961</span>, <span class="number">23492045323953392330208784813581654383480854895526105331150055254139460724192</span>, <span class="number">17080512298466023233312431592445586950706981939186458231843048823545276010215</span>, <span class="number">39604091535611342500963237243447065555062876641002877504522940232561620619318</span>, <span class="number">56960961102475075778327243487866255394103198246135548238726100230622806328438</span>, <span class="number">38217368372409493349493021940482885382608210497803407862232172289864983784622</span>, <span class="number">42335856751075392349376312407843682476509683741291872419641417363122382815132</span>, <span class="number">51941219313167868120916202016894056878767165096252120052547694800835266376234</span>, <span class="number">39291827760740007097926684492849490059616209795648655493766840810548112692299</span>, <span class="number">43135915013972209275982685899523579484981852752898836057210548592960639003728</span>, <span class="number">23595516638571580424735519959966735718018613005573597878458733582530644060888</span>, <span class="number">62827451288017543974020113222032392007291072051169612626408144208347674696867</span>, <span class="number">5592384352020377877919583422508787142347256068192656512514358468697868033175</span>, <span class="number">18051963256426258602161226818544125427525613549556239701594042609393802930037</span>, <span class="number">40958445768744523216077674511494171471872825559820257375045060058213312003099</span>, <span class="number">58717128055983851157674774153408247177039629801049962370399870689530231499322</span>, <span class="number">1037221856690142468199057506665941102592008657830329236867815734600280869030</span>, <span class="number">59376420054790038148696948468280202162475373720884110232519335695030684164414</span>, <span class="number">4151096619484839840558543718588323193224649180369287745679082104762052554517</span>, <span class="number">59388992954098787668810593349809442685161783884520951198437714884153766418952</span>, <span class="number">2963435422634311858110276357146679864581253927895056591004158165102829287371</span>, <span class="number">41537819812103905985231524610057365971827624339877580912325361702870004864439</span>, <span class="number">39640428648253591645759865709120529164727198669907353665694566732915196666123</span>, <span class="number">40517325937253252797947519549738947711994111971749366539987665346423972531224</span>]</span><br><span class="line">iv = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;f62c1400190702198a26c4f855030f8c&quot;</span>)</span><br><span class="line">ct = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;9580af623a2427920469c31407f9cec7ccab2389cb3a120869106bf6c6f6fe09810172a1f0f3892c321237ac0e4b7d9a&quot;</span>)</span><br><span class="line"></span><br><span class="line">MG = Matrix(GF(p),<span class="number">5</span>,<span class="number">5</span>,G)</span><br><span class="line">MA = Matrix(GF(p),<span class="number">5</span>,<span class="number">5</span>,A)</span><br><span class="line">MB = Matrix(GF(p),<span class="number">5</span>,<span class="number">5</span>,B)</span><br><span class="line"></span><br><span class="line">J, P = MG.jordan_form(transformation = <span class="literal">True</span>)</span><br><span class="line">MA = P^-<span class="number">1</span> * MA * P</span><br><span class="line">MB = P^-<span class="number">1</span> * MB * P</span><br><span class="line"></span><br><span class="line">kA = MA[<span class="number">3</span>, <span class="number">4</span>] / MA[<span class="number">3</span>, <span class="number">3</span>] * J[<span class="number">3</span>, <span class="number">3</span>]</span><br><span class="line">kB = MB[<span class="number">3</span>, <span class="number">4</span>] / MB[<span class="number">3</span>, <span class="number">3</span>] * J[<span class="number">3</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">shared_secret = list_exp(B,kA,p)[<span class="number">0</span>]</span><br><span class="line">key = sha1(<span class="built_in">str</span>(shared_secret).encode(<span class="string">&#x27;ascii&#x27;</span>)).digest()[:<span class="number">16</span>]</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">flag = cipher.decrypt(ct)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># union&#123;high3r_d1m3n510ns_l0w3r_s3cur1ty&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="why-is-a-raven"><a href="#why-is-a-raven" class="headerlink" title="why is a raven.."></a>why is a raven..</h3><p>This writeup is referenced from <a target="_blank" rel="noopener" href="https://rkm0959.tistory.com/206">rkm0959</a></p>
<h4 id="Analysis-4"><a href="#Analysis-4" class="headerlink" title="Analysis"></a>Analysis</h4><p>This is a <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Supersingular_isogeny_key_exchange">Supersingular isogeny Diffie–Hellman</a> challenge:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">p = <span class="number">2</span>^<span class="number">216</span>*<span class="number">3</span>^<span class="number">137</span> - <span class="number">1</span></span><br><span class="line">F.&lt;i&gt; = GF(p^<span class="number">2</span>, modulus=x^<span class="number">2</span>+<span class="number">1</span>)</span><br><span class="line">E = EllipticCurve(F, [<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">xQ20=<span class="number">0x000C7461738340EFCF09CE388F666EB38F7F3AFD42DC0B664D9F461F31AA2EDC6B4AB71BD42F4D7C058E13F64B237EF7DDD2ABC0DEB0C6C</span></span><br><span class="line">xQ21=<span class="number">0x00025DE37157F50D75D320DD0682AB4A67E471586FBC2D31AA32E6957FA2B2614C4CD40A1E27283EAAF4272AE517847197432E2D61C85F5</span></span><br><span class="line">yQ20=<span class="number">0x001D407B70B01E4AEE172EDF491F4EF32144F03F5E054CEF9FDE5A35EFA3642A11817905ED0D4F193F31124264924A5F64EFE14B6EC97E5</span></span><br><span class="line">yQ21=<span class="number">0x000E7DEC8C32F50A4E735A839DCDB89FE0763A184C525F7B7D0EBC0E84E9D83E9AC53A572A25D19E1464B509D97272AE761657B4765B3D6</span></span><br><span class="line">xP20=<span class="number">0x0003CCFC5E1F050030363E6920A0F7A4C6C71E63DE63A0E6475AF621995705F7C84500CB2BB61E950E19EAB8661D25C4A50ED279646CB48</span></span><br><span class="line">xP21=<span class="number">0x001AD1C1CAE7840EDDA6D8A924520F60E573D3B9DFAC6D189941CB22326D284A8816CC4249410FE80D68047D823C97D705246F869E3EA50</span></span><br><span class="line">yP20=<span class="number">0x001AB066B84949582E3F66688452B9255E72A017C45B148D719D9A63CDB7BE6F48C812E33B68161D5AB3A0A36906F04A6A6957E6F4FB2E0</span></span><br><span class="line">yP21=<span class="number">0x000FD87F67EA576CE97FF65BF9F4F7688C4C752DCE9F8BD2B36AD66E04249AAF8337C01E6E4E1A844267BA1A1887B433729E1DD90C7DD2F</span></span><br><span class="line">xQ30=<span class="number">0x0012E84D7652558E694BF84C1FBDAAF99B83B4266C32EC65B10457BCAF94C63EB063681E8B1E7398C0B241C19B9665FDB9E1406DA3D3846</span></span><br><span class="line">xQ31=<span class="number">0x0000000</span></span><br><span class="line">yQ30=<span class="number">0x0000000</span></span><br><span class="line">yQ31=<span class="number">0x000EBAAA6C731271673BEECE467FD5ED9CC29AB564BDED7BDEAA86DD1E0FDDF399EDCC9B49C829EF53C7D7A35C3A0745D73C424FB4A5FD2</span></span><br><span class="line">xP30=<span class="number">0x0008664865EA7D816F03B31E223C26D406A2C6CD0C3D667466056AAE85895EC37368BFC009DFAFCB3D97E639F65E9E45F46573B0637B7A9</span></span><br><span class="line">xP31=<span class="number">0x0000000</span></span><br><span class="line">yP30=<span class="number">0x0006AE515593E73976091978DFBD70BDA0DD6BCAEEBFDD4FB1E748DDD9ED3FDCF679726C67A3B2CC12B39805B32B612E058A4280764443B</span></span><br><span class="line">yP31=<span class="number">0x0000000</span></span><br><span class="line"></span><br><span class="line">Q_A = E(xQ20 + xQ21*i, yQ20 + yQ21*i)</span><br><span class="line">P_A = E(xP20 + xP21*i, yP20 + yP21*i)</span><br><span class="line">Q_B = E(xQ30 + xQ31*i, yQ30 + yQ31*i)</span><br><span class="line">P_B = E(xP30 + xP31*i, yP30 + yP31*i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Computes an l^e-isogeny out of E from a set Ss of kernel generators</span></span><br><span class="line"><span class="comment"># as a composition of e l-isogenies</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">computeIsogeny</span>(<span class="params">E, Ss, l, e</span>):</span><br><span class="line">    S_tmps = Ss</span><br><span class="line">    E_tmp = E</span><br><span class="line">    ϕ = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(e):</span><br><span class="line">        R_tmps = S_tmps</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(e-k-<span class="number">1</span>):</span><br><span class="line">            R_tmps = [ l*R_tmp <span class="keyword">for</span> R_tmp <span class="keyword">in</span> R_tmps ]</span><br><span class="line">        ϕ_k = E_tmp.isogeny(kernel=R_tmps)</span><br><span class="line"></span><br><span class="line">        S_tmps = [ ϕ_k(S_tmp) <span class="keyword">for</span> S_tmp <span class="keyword">in</span> S_tmps ]</span><br><span class="line">        E_tmp = ϕ_k.codomain()</span><br><span class="line">        <span class="keyword">if</span> ϕ <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            ϕ = ϕ_k</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ϕ = ϕ_k * ϕ</span><br><span class="line">    <span class="keyword">return</span> ϕ</span><br><span class="line"></span><br><span class="line">k_A = randint(<span class="number">0</span>, <span class="number">2</span>^<span class="number">216</span>-<span class="number">1</span>)</span><br><span class="line">S_A = P_A + k_A*Q_A</span><br><span class="line">ϕ_A = computeIsogeny(E, [S_A], <span class="number">2</span>, <span class="number">216</span>)</span><br><span class="line">Alice = (ϕ_A.codomain().a_invariants(), ϕ_A(P_B).xy(), ϕ_A(Q_B).xy(), ϕ_A(P_A).xy(), ϕ_A(Q_A).xy())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Alice = <span class="subst">&#123;Alice&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">k_B = randint(<span class="number">0</span>, <span class="number">3</span>^<span class="number">137</span>-<span class="number">1</span>) </span><br><span class="line">S_B = P_B + k_B*Q_B</span><br><span class="line">ϕ_B = computeIsogeny(E, [S_B], <span class="number">3</span>, <span class="number">137</span>)</span><br><span class="line">Bob = (ϕ_B.codomain().a_invariants(), ϕ_B(P_A).xy(), ϕ_B(Q_A).xy())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Bob = <span class="subst">&#123;Bob&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">(E_B, B_P_A, B_Q_A) = Bob</span><br><span class="line">E_B = EllipticCurve(F, E_B)</span><br><span class="line">B_P_A = E_B(B_P_A)</span><br><span class="line">B_Q_A = E_B(B_Q_A)</span><br><span class="line">B_S_A = B_P_A + k_A*B_Q_A</span><br><span class="line">jAlice = computeIsogeny(E_B, [B_S_A], <span class="number">2</span>, <span class="number">216</span>).codomain().j_invariant()</span><br><span class="line"></span><br><span class="line">(E_A, A_P_B, A_Q_B, _, _) = Alice</span><br><span class="line">E_A = EllipticCurve(F, E_A)</span><br><span class="line">A_P_B = E_A(A_P_B)</span><br><span class="line">A_Q_B = E_A(A_Q_B)</span><br><span class="line">A_S_B = A_P_B + k_B*A_Q_B</span><br><span class="line">jBob = computeIsogeny(E_A, [A_S_B], <span class="number">3</span>, <span class="number">137</span>).codomain().j_invariant()</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> jAlice == jBob</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read().strip()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">32</span></span><br><span class="line"></span><br><span class="line">sk = hashlib.sha256(<span class="built_in">str</span>(jAlice).encode(<span class="string">&#x27;ascii&#x27;</span>)).digest()[:<span class="number">16</span>]</span><br><span class="line">cipher = AES.new(sk, AES.MODE_CBC)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;iv = <span class="subst">&#123;b64encode(cipher.iv)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ct = <span class="subst">&#123;b64encode(cipher.encrypt(flag))&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>If you want to know <code>SIDH</code>, you can read <a target="_blank" rel="noopener" href="https://sectt.github.io/writeups/UnionCTF21/crypto_raven/README">this write-up</a>.</p>
<p>And if we focus on the code, we can simply see that <code>Alice</code> send something important:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ϕ_A(P_A).xy(), ϕ_A(Q_A).xy()</span><br></pre></td></tr></table></figure>

<p>Since $ϕ_A$ has:<br>$$<br>S_A &#x3D; P_A + k_AQ_A<br>$$<br>as its kernel, we can get:<br>$$<br>\phi(S_A) &#x3D; \phi(P_A + k_AQ_A) &#x3D; \phi(P_A) + k_A\phi(Q_A) &#x3D; 0<br>$$<br>So we can just calculate $k_A$ with <code>discrete_log</code></p>
<h4 id="Exp-4"><a href="#Exp-4" class="headerlink" title="Exp"></a>Exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">p = <span class="number">2</span>^<span class="number">216</span>*<span class="number">3</span>^<span class="number">137</span> - <span class="number">1</span></span><br><span class="line">F.&lt;i&gt; = GF(p^<span class="number">2</span>, modulus=x^<span class="number">2</span>+<span class="number">1</span>)</span><br><span class="line">E = EllipticCurve(F, [<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">xQ20=<span class="number">0x000C7461738340EFCF09CE388F666EB38F7F3AFD42DC0B664D9F461F31AA2EDC6B4AB71BD42F4D7C058E13F64B237EF7DDD2ABC0DEB0C6C</span></span><br><span class="line">xQ21=<span class="number">0x00025DE37157F50D75D320DD0682AB4A67E471586FBC2D31AA32E6957FA2B2614C4CD40A1E27283EAAF4272AE517847197432E2D61C85F5</span></span><br><span class="line">yQ20=<span class="number">0x001D407B70B01E4AEE172EDF491F4EF32144F03F5E054CEF9FDE5A35EFA3642A11817905ED0D4F193F31124264924A5F64EFE14B6EC97E5</span></span><br><span class="line">yQ21=<span class="number">0x000E7DEC8C32F50A4E735A839DCDB89FE0763A184C525F7B7D0EBC0E84E9D83E9AC53A572A25D19E1464B509D97272AE761657B4765B3D6</span></span><br><span class="line">xP20=<span class="number">0x0003CCFC5E1F050030363E6920A0F7A4C6C71E63DE63A0E6475AF621995705F7C84500CB2BB61E950E19EAB8661D25C4A50ED279646CB48</span></span><br><span class="line">xP21=<span class="number">0x001AD1C1CAE7840EDDA6D8A924520F60E573D3B9DFAC6D189941CB22326D284A8816CC4249410FE80D68047D823C97D705246F869E3EA50</span></span><br><span class="line">yP20=<span class="number">0x001AB066B84949582E3F66688452B9255E72A017C45B148D719D9A63CDB7BE6F48C812E33B68161D5AB3A0A36906F04A6A6957E6F4FB2E0</span></span><br><span class="line">yP21=<span class="number">0x000FD87F67EA576CE97FF65BF9F4F7688C4C752DCE9F8BD2B36AD66E04249AAF8337C01E6E4E1A844267BA1A1887B433729E1DD90C7DD2F</span></span><br><span class="line">xQ30=<span class="number">0x0012E84D7652558E694BF84C1FBDAAF99B83B4266C32EC65B10457BCAF94C63EB063681E8B1E7398C0B241C19B9665FDB9E1406DA3D3846</span></span><br><span class="line">xQ31=<span class="number">0x0000000</span></span><br><span class="line">yQ30=<span class="number">0x0000000</span></span><br><span class="line">yQ31=<span class="number">0x000EBAAA6C731271673BEECE467FD5ED9CC29AB564BDED7BDEAA86DD1E0FDDF399EDCC9B49C829EF53C7D7A35C3A0745D73C424FB4A5FD2</span></span><br><span class="line">xP30=<span class="number">0x0008664865EA7D816F03B31E223C26D406A2C6CD0C3D667466056AAE85895EC37368BFC009DFAFCB3D97E639F65E9E45F46573B0637B7A9</span></span><br><span class="line">xP31=<span class="number">0x0000000</span></span><br><span class="line">yP30=<span class="number">0x0006AE515593E73976091978DFBD70BDA0DD6BCAEEBFDD4FB1E748DDD9ED3FDCF679726C67A3B2CC12B39805B32B612E058A4280764443B</span></span><br><span class="line">yP31=<span class="number">0x0000000</span></span><br><span class="line"></span><br><span class="line">Q_A = E(xQ20 + xQ21*i, yQ20 + yQ21*i)</span><br><span class="line">P_A = E(xP20 + xP21*i, yP20 + yP21*i)</span><br><span class="line">Q_B = E(xQ30 + xQ31*i, yQ30 + yQ31*i)</span><br><span class="line">P_B = E(xP30 + xP31*i, yP30 + yP31*i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Computes an l^e-isogeny out of E from a set Ss of kernel generators</span></span><br><span class="line"><span class="comment"># as a composition of e l-isogenies</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">computeIsogeny</span>(<span class="params">E, Ss, l, e</span>):</span><br><span class="line">    S_tmps = Ss</span><br><span class="line">    E_tmp = E</span><br><span class="line">    ϕ = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(e):</span><br><span class="line">        R_tmps = S_tmps</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(e-k-<span class="number">1</span>):</span><br><span class="line">            R_tmps = [ l*R_tmp <span class="keyword">for</span> R_tmp <span class="keyword">in</span> R_tmps ]</span><br><span class="line">        ϕ_k = E_tmp.isogeny(kernel=R_tmps)</span><br><span class="line"></span><br><span class="line">        S_tmps = [ ϕ_k(S_tmp) <span class="keyword">for</span> S_tmp <span class="keyword">in</span> S_tmps ]</span><br><span class="line">        E_tmp = ϕ_k.codomain()</span><br><span class="line">        <span class="keyword">if</span> ϕ <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            ϕ = ϕ_k</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ϕ = ϕ_k * ϕ</span><br><span class="line">    <span class="keyword">return</span> ϕ</span><br><span class="line"></span><br><span class="line">Alice = ((<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">6001602663961206370988750155271268843249113105575064100544244329723627508642651491029799456469448718421085928092642609765039188242</span>*i + <span class="number">17122560027285283790825644308649714063340414789188915872095421354901510218060415163697310413170734130335144089439494750625538071980</span>, <span class="number">22241966002746626067354539975418232642475646213518284443509300453664841759671344583904727702765870170961054029730219838438930886730</span>*i + <span class="number">6295409890219768050656401214128285134680958664621604435525993857295024885942522198730338761351461854361939143813589229958450834937</span>), (<span class="number">20693617845250531673791079572257479372406496374051176010221583150895284635664420984163027961195027146723306399733543575074371571546</span>*i + <span class="number">12579440504826227790399898461168329080116453795381885031938887599830693619864645875985379594607106805272063128287141040474324472579</span>, <span class="number">17003339040898697587060167865681315428279965204095022676751761236717662173320135824191474549296911745414760875386583097246892970743</span>*i + <span class="number">2450227209495560745928392442008559789430024267104386893781343959329588604681368476319376824183170770268590193199446339985032818433</span>), (<span class="number">24196999226902675779045571226331502647086872832197399777068255320010293863359017283213324144431537822661506383681353187559191999771</span>*i + <span class="number">14031872773998733507298731440596005313939108957137912313429212267974724984039194243338858626174518892025349039167378718436374581722</span>, <span class="number">10067956801857468023514754660550671095579147019588599811273848235704360993890497575424172688000039308192770149207724142524545451074</span>*i + <span class="number">9704956586624341710808951764565861341114293792082683257320510639095567055930904001585984811139137392398321200917960531515122425604</span>), (<span class="number">21482597851178884503353076937735588452957177768806776910812379517549572253101759233236102347370343956671258496673645283509995572850</span>*i + <span class="number">14096078902807078355928598956816130045619245790159384751176932745646753234211180941505758827833314091690388346935619473665442809259</span>, <span class="number">13679392986650554551011681934303695650088628896811869083453967966676089303335417699532232752393700725181942165609165070072195990421</span>*i + <span class="number">22303973329492411565669001646989446651767650420180177485066511378012378529261175557912535448570067170663048114739927772127080694786</span>), (<span class="number">5031508630808576087782892353323275460174142373365249589846782383660521445945988018058115279743582819518492860550820586178080959929</span>*i + <span class="number">20361864043088022309832424954188288334129520236737890920001299362176525293198035690628699135584668073379687130832090636102750496003</span>, <span class="number">5326896702997677262072220524322872052674185107431056651996898750306495168544570294686542579294013185895403025686718275379409582021</span>*i + <span class="number">7018087072590614715963128743406699936749123349867893045580774389322712378049822434865393438816413618294542843639485193888664986503</span>))</span><br><span class="line">Bob = ((<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">2510377837984569005668272963938229152759212776314258952545654072169410901298850712372306096701112903052487282410712205434980682770</span>*i + <span class="number">1533616599018469519548641055342254252507904258735350043186382046019246639038089759129707675919612374167907298647004842048842483225</span>, <span class="number">13335813103700469160284801960413086144549776993448017319107340684719947118153850729369660724596130930055245047262733708054423015655</span>*i + <span class="number">17338799868192494405204548102094725343306200019012693785648257092061088427620739800739315465276207804594142456129224673452195357714</span>), (<span class="number">2771195673566835722887342815479686444463738278075014443830431110033775598812266459191044593910730473384513927831673567602258951977</span>*i + <span class="number">14695642564069380381636057787623481658663045420929947439988595067986417545517691517441254145488869846179463754817003384192274626463</span>, <span class="number">18564301293503451778592169644157610474379393936432543000343986957900909392616771402521075243703340903344745798060095728893961976940</span>*i + <span class="number">19628333731314344646926186187873836263784148023213378217245128148326949516664862760385029489345376891188072162779569669305066964933</span>), (<span class="number">22650214990480384681860370457554162699319780968761610136003430194938807060051700030135993836240770510069117319449743388225281444184</span>*i + <span class="number">3377155996988041268039072873935941531295378688722591082040326948052676519006168915555632884024981285908480033902758240587615693054</span>, <span class="number">17806681788782120983952163360625445316482360798557639190977860032884873427321883793075291472918577432082376117267831746467121303568</span>*i + <span class="number">21533180999838449404329422084189008931697041812999894837076670480949795196804840300494281304611360768987802541355649881398701758313</span>))</span><br><span class="line">iv = <span class="string">b&#x27;XSglnu+2ZwFuHGE8ddIuJQ==&#x27;</span></span><br><span class="line">ct = <span class="string">b&#x27;4VR9ty+lFW6oQoWTVHiDE7A9uKw0KbQzpnCWOGVQXGo=&#x27;</span></span><br><span class="line"></span><br><span class="line">(E_A, A_P_B, A_Q_B, A_P_A, A_Q_A) = Alice</span><br><span class="line">E_A = EllipticCurve(F, E_A)</span><br><span class="line">A_P_B = E_A(A_P_B)</span><br><span class="line">A_Q_B = E_A(A_Q_B)</span><br><span class="line">A_P_A = E_A(A_P_A)</span><br><span class="line">A_Q_A = E_A(A_Q_A)</span><br><span class="line"></span><br><span class="line">(E_B, B_P_A, B_Q_A) = Bob</span><br><span class="line">E_B = EllipticCurve(F, E_B)</span><br><span class="line">B_P_A = E_B(B_P_A)</span><br><span class="line">B_Q_A = E_B(B_Q_A)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A_P_A + k_A * A_Q_A == 0</span></span><br><span class="line">k_A = discrete_log(E_A(<span class="number">0</span>) - A_P_A, A_Q_A, <span class="built_in">ord</span> = <span class="number">2</span> ^ <span class="number">216</span>, operation = <span class="string">&quot;+&quot;</span>)</span><br><span class="line"></span><br><span class="line">B_S_A = B_P_A + k_A * B_Q_A</span><br><span class="line">jAlice = computeIsogeny(E_B, [B_S_A], <span class="number">2</span>, <span class="number">216</span>).codomain().j_invariant()</span><br><span class="line"></span><br><span class="line">sk = hashlib.sha256(<span class="built_in">str</span>(jAlice).encode(<span class="string">&#x27;ascii&#x27;</span>)).digest()[:<span class="number">16</span>]</span><br><span class="line">iv = b64decode(iv)</span><br><span class="line">ct = b64decode(ct)</span><br><span class="line">cipher = AES.new(sk, AES.MODE_CBC, iv)</span><br><span class="line">flag = cipher.decrypt(ct)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># union&#123;al1c3_in_t0r51ongr0upl4nd&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">https://en.wikipedia.org/wiki/Man-in-the-middle_attack</a></p>
<p><a target="_blank" rel="noopener" href="https://rkm0959.tistory.com/206">https://rkm0959.tistory.com/206</a></p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Jordan_normal_form">https://en.wikipedia.org/wiki/Jordan_normal_form</a></p>
<p><a target="_blank" rel="noopener" href="https://sectt.github.io/writeups/UnionCTF21/crypto_raven/README">https://sectt.github.io/writeups/UnionCTF21/crypto_raven/README</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Vergissmeinnicht</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://ret2ver.github.io/2021/02/23/2021UnionCTF-WriteUp/">https://ret2ver.github.io/2021/02/23/2021UnionCTF-WriteUp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/03/09/%E6%B5%85%E6%9E%90SM4%E4%B8%AD%E7%9A%84DFA-attack/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">浅析SM4中的DFA attack</div></div></a></div><div class="next-post pull-right"><a href="/2021/02/23/Chrome-issue-1793%E5%88%86%E6%9E%90/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Chrome issue-1793分析</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2022/04/29/RkrKDQiodbYj2eu.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Vergissmeinnicht</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">38</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">32</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ret2ver"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ret2ver" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:verhan@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Live Long And Pwn.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#human-server"><span class="toc-number">2.1.</span> <span class="toc-text">human_server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis"><span class="toc-number">2.1.1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exp"><span class="toc-number">2.1.2.</span> <span class="toc-text">Exp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mordell-primes"><span class="toc-number">2.2.</span> <span class="toc-text">Mordell primes</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exp-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">Exp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cr0wn-St3rling"><span class="toc-number">2.3.</span> <span class="toc-text">Cr0wn St3rling</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exp-2"><span class="toc-number">2.3.2.</span> <span class="toc-text">Exp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Neo-Classical-Key-Exchange"><span class="toc-number">2.4.</span> <span class="toc-text">Neo-Classical Key Exchange</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-3"><span class="toc-number">2.4.1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exp-3"><span class="toc-number">2.4.2.</span> <span class="toc-text">Exp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#why-is-a-raven"><span class="toc-number">2.5.</span> <span class="toc-text">why is a raven..</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-4"><span class="toc-number">2.5.1.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exp-4"><span class="toc-number">2.5.2.</span> <span class="toc-text">Exp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">3.</span> <span class="toc-text">References</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/14/AFL%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-afl-fuzz/" title="AFL源码阅读 - afl-fuzz">AFL源码阅读 - afl-fuzz</a><time datetime="2022-03-14T09:35:50.000Z" title="Created 2022-03-14 17:35:50">2022-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/14/AFL%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-afl-clang-fast/" title="AFL源码阅读 - afl-clang-fast">AFL源码阅读 - afl-clang-fast</a><time datetime="2022-03-14T06:47:50.000Z" title="Created 2022-03-14 14:47:50">2022-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/13/AFL%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-afl-as/" title="AFL源码阅读 - afl-as">AFL源码阅读 - afl-as</a><time datetime="2022-03-13T07:04:50.000Z" title="Created 2022-03-13 15:04:50">2022-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/13/AFL%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB-afl-gcc/" title="AFL源码阅读 - afl-gcc">AFL源码阅读 - afl-gcc</a><time datetime="2022-03-13T05:22:50.000Z" title="Created 2022-03-13 13:22:50">2022-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/02/05/CVE-2021-43226-%EF%BC%9ACLFS-%E4%B8%AD%E7%9A%84%E6%A0%88%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/" title="CVE-2021-43226 ：CLFS 中的栈溢出漏洞">CVE-2021-43226 ：CLFS 中的栈溢出漏洞</a><time datetime="2022-02-05T06:56:21.000Z" title="Created 2022-02-05 14:56:21">2022-02-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Vergissmeinnicht</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>